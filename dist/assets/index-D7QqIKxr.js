(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const b="http://localhost:3000/todos";async function R(e,t,o){return await(await fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({titulo:e,descripcion:t,userId:o,estado:"pendiente",createdAt:new Date().toISOString()})})).json()}async function J(e){const t=await fetch(b);if(!t.ok)throw new Error("Error al obtener tareas");return(await t.json()).filter(a=>a.userId===e)}async function H(e,t,o,a){const r=await fetch(`${b}/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({titulo:t,descripcion:o,userId:a})});if(!r.ok)throw new Error("No se pudo actualizar la tarea");return await r.json()}async function V(e){if(!(await fetch(`${b}/${e}`,{method:"DELETE"})).ok)throw new Error("No se pudo borrar la tarea");return!0}async function G(e,t,o){return await R(e,t,o)}async function W(e){return(await J(e)).slice(-5).reverse()}function Y(e,t={}){const{titulo:o="",estado:a="",sortBy:r="fecha",sortDir:s="desc"}=t;let i=Array.isArray(e)?[...e]:[];if(o&&o.trim()!==""){const c=o.trim().toLowerCase();i=i.filter(m=>(m.titulo||"").toLowerCase().includes(c))}a&&a.trim()!==""&&(i=i.filter(c=>c.estado===a));const E=s==="asc"?1:-1;return i.sort((c,m)=>{if(r==="titulo"){const v=(c.titulo||"").toLowerCase(),g=(m.titulo||"").toLowerCase();return v<g?-1*E:v>g?1*E:0}if(r==="estado"){const v=(c.estado||"").toLowerCase(),g=(m.estado||"").toLowerCase();return v<g?-1*E:v>g?1*E:0}const z=c.createdAt?Date.parse(c.createdAt):0,$=m.createdAt?Date.parse(m.createdAt):0;return(z-$)*E}),i}async function _(e){return await V(e)}async function K(e,t,o,a){return await H(e,t,o,a)}function Q(e){return JSON.stringify(e,null,2)}let k=null;function y(){return k||(k={errorTitulo:document.getElementById("error-titulo"),errorDescripcion:document.getElementById("error-descripcion"),errorUsuario:document.getElementById("error-usuario"),errorUsuarioBusqueda:document.getElementById("error-usuario-busqueda"),taskTitle:document.getElementById("titulo"),taskDescription:document.getElementById("descripcion"),userSelect:document.getElementById("user-id"),userSelectExternal:document.getElementById("user-select"),taskForm:document.getElementById("task-form"),deleteModal:document.getElementById("delete-modal")}),k}function X(e,t){if(t.innerHTML="",!e||e.length===0){t.innerHTML='<p class="no-tasks">No hay tareas para mostrar.</p>';return}e.forEach(o=>{const a=document.createElement("div");a.classList.add("task-card"),a.innerHTML=`
            <div class="div-task">
                <h3>${o.titulo}</h3>
                <p>${o.descripcion}</p>
                <div class="task-estado">
                    <span class="estado-badge estado-${o.estado?.replace(/\s+/g,"-")}">${o.estado||"Sin estado"}</span>
                </div>
                <div class="task-buttons">
                    <button type="button" class="btn edit" data-id="${o.id}">Editar</button>
                    <button type="button" class="btn delete" data-id="${o.id}">Borrar</button>
                </div>
            </div>
        `,t.appendChild(a)})}function D(e){const t=y();t.errorUsuarioBusqueda&&(t.errorUsuarioBusqueda.textContent=e),t.userSelectExternal&&t.userSelectExternal.classList.add("error")}function T(e,t,o){e&&e.classList.add("error"),t&&(t.textContent=o)}function Z(e){const t=y();e.titulo&&T(t.taskTitle,t.errorTitulo,e.titulo),e.descripcion&&T(t.taskDescription,t.errorDescripcion,e.descripcion),e.usuario&&T(t.userSelect,t.errorUsuario,e.usuario)}function ee(){const e=y();e.deleteModal&&e.deleteModal.classList.add("show")}function q(){const e=y();e.deleteModal&&e.deleteModal.classList.remove("show")}function te(e){const t=y(),o=document.getElementById("user-select");t.taskTitle&&(t.taskTitle.value=e.titulo),t.taskDescription&&(t.taskDescription.value=e.descripcion),t.userSelect&&(t.userSelect.value=e.userId),o&&(o.value=e.userId);const a=t.taskForm?.querySelector(".submit");a&&(a.textContent="Actualizar Tarea",a.dataset.editId=e.id),t.taskForm&&t.taskForm.scrollIntoView({behavior:"smooth"})}function j(){const e=y();e.taskForm&&e.taskForm.reset();const t=e.taskForm?.querySelector(".submit");t&&(t.textContent="Guardar Tarea",delete t.dataset.editId)}function re(e,t,o){const a=new Blob([e],{type:o}),r=URL.createObjectURL(a),s=document.createElement("a");s.href=r,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}let p=null;function oe(){return p||(p=document.createElement("div"),p.id="notification-toast-container",Object.assign(p.style,{position:"fixed",top:"20px",right:"20px",zIndex:"9999",display:"flex",flexDirection:"column",gap:"10px"}),document.body.appendChild(p)),p}function w(e,t){const o=oe(),a=document.createElement("div");Object.assign(a.style,{padding:"15px 20px",borderRadius:"5px",color:"white",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",minWidth:"250px",maxWidth:"400px",fontSize:"14px",fontFamily:"sans-serif",animation:"fadeIn 0.3s ease-in-out"});const r={success:"#28a745",error:"#dc3545",info:"#17a2b8"};a.style.backgroundColor=r[t]||r.info,a.textContent=e,o.appendChild(a),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>a.remove(),300)},5e3)}function I(e){w(e,"success")}function d(e){w(e,"error")}function ae(e){w(e,"info")}function ne(e){return!e||e.trim()===""?{valido:!1,error:"El t√≠tulo es obligatorio. Por favor, ingr√©selo."}:e.trim().length<3?{valido:!1,error:"El t√≠tulo debe tener al menos 3 caracteres."}:{valido:!0,error:null}}function se(e){return!e||e.trim()===""?{valido:!1,error:"La descripci√≥n es obligatoria. Por favor, ingr√©sela."}:e.trim().length<10?{valido:!1,error:"La descripci√≥n debe tener al menos 10 caracteres."}:{valido:!0,error:null}}function ie(e){return!e||e.trim()===""?{valido:!1,error:"El usuario es obligatorio. Por favor, seleccione un usuario."}:{valido:!0,error:null}}function ce(e,t,o){const a={},r=ne(e);r.valido||(a.titulo=r.error);const s=se(t);s.valido||(a.descripcion=s.error);const i=ie(o);return i.valido||(a.usuario=i.error),a}const n={tareasActuales:[],deleteTaskId:null,deleteEventTarget:null,estadoActual:"",tituloActual:"",sortBy:"fecha",sortDir:"desc"};async function A(e){if(!e){D("Por favor, ingrese un ID de usuario.");return}try{n.tareasActuales=await W(e),n.estadoActual="",n.tituloActual="",n.sortBy="fecha",n.sortDir="desc",le(),f()}catch(t){console.error(t),D("Error al mostrar tareas. Verifique el usuario o la conexi√≥n.")}}function le(){const e=document.getElementById("estado-filter"),t=document.getElementById("titulo-filter"),o=document.getElementById("sort-by"),a=document.getElementById("sort-dir");e&&(e.value=""),t&&(t.value=""),o&&(o.value="fecha"),a&&(a.textContent="Desc")}function f(){const e={titulo:n.tituloActual,estado:n.estadoActual,sortBy:n.sortBy,sortDir:n.sortDir},t=Y(n.tareasActuales,e),o=document.querySelector(".tasks-container");X(t,o)}function de(e){n.estadoActual=e,f()}function ue(e){n.tituloActual=e,f()}function fe(e){n.sortBy=e,f()}function me(){n.sortDir=n.sortDir==="asc"?"desc":"asc";const e=document.getElementById("sort-dir");e&&(e.textContent=n.sortDir==="asc"?"Asc":"Desc"),f()}function pe(e){const t=n.tareasActuales.find(o=>o.id==e);t&&te(t)}function ye(e,t){n.deleteTaskId=e,n.deleteEventTarget=t,ee()}async function Ee(){if(n.deleteTaskId)try{await _(n.deleteTaskId);const e=n.deleteEventTarget.closest(".task-card");e&&e.remove(),n.tareasActuales=n.tareasActuales.filter(t=>t.id!=n.deleteTaskId),I("‚úÖ Tarea eliminada correctamente.")}catch(e){console.error(e),d("Error del sistema: No se pudo eliminar la tarea. Por favor, intente m√°s tarde.")}finally{q(),n.deleteTaskId=null,n.deleteEventTarget=null}}function M(){q(),n.deleteTaskId=null,n.deleteEventTarget=null}async function ve(e,t,o){const a=ce(e,t,o);if(Object.keys(a).length>0){d("Por favor, corrija los errores en el formulario."),Z(a);return}try{const r=await G(e,t,o);n.tareasActuales.unshift(r),f(),I("‚úÖ Tarea registrada exitosamente."),j()}catch(r){console.error(r),r.message&&r.message.includes("Failed to fetch")?d("Error de conexi√≥n: No se pudo conectar con el servidor. Verifique su conexi√≥n a internet e intente m√°s tarde."):r.message&&r.message.includes("500")?d("Error del servidor: Ocurri√≥ un problema interno. Por favor, intente m√°s tarde."):r.message&&r.message.includes("404")?d("Error: No se encontr√≥ el recurso solicitado. Contacte al administrador."):d("Error del sistema: No se pudo registrar la tarea. Por favor, intente m√°s tarde.")}}async function ge(e,t,o,a){try{await K(e,t,o,a);const r=n.tareasActuales.findIndex(s=>s.id==e);r!==-1&&(n.tareasActuales[r].titulo=t,n.tareasActuales[r].descripcion=o,n.tareasActuales[r].userId=a),f(),I("‚úÖ Tarea actualizada correctamente."),j()}catch(r){console.error(r),d("Error del sistema: No se pudo actualizar la tarea. Por favor, intente m√°s tarde.")}}function he(){if(document.querySelector(".tasks-container"),!n.tareasActuales||n.tareasActuales.length===0){ae("‚ÑπÔ∏è No hay tareas visibles para exportar.");return}const e=Q(n.tareasActuales);re(e,"tareas_exportadas.json","application/json"),I("‚úÖ Tareas exportadas correctamente.")}const x=document.getElementById("task-form"),Be=document.getElementById("titulo"),be=document.getElementById("descripcion"),l=document.getElementById("user-id"),u=document.getElementById("user-select"),C=document.getElementById("refresh-btn"),S=document.getElementById("estado-filter"),F=document.getElementById("titulo-filter"),N=document.getElementById("sort-by"),O=document.getElementById("sort-dir"),h=document.querySelector(".tasks-container"),L=document.getElementById("delete-modal"),P=document.getElementById("confirm-delete"),U=document.getElementById("cancel-delete");u&&l&&(u.addEventListener("input",()=>{l.value=u.value}),l.addEventListener("input",()=>{u.value=l.value}));document.addEventListener("DOMContentLoaded",async()=>{l.value&&await A(l.value)});u&&u.addEventListener("keypress",async e=>{e.key==="Enter"&&(e.preventDefault(),await A(u.value))});C&&C.addEventListener("click",async()=>{await A(l.value)});S&&S.addEventListener("change",e=>{de(e.target.value)});F&&F.addEventListener("input",e=>{ue(e.target.value)});N&&N.addEventListener("change",e=>{fe(e.target.value)});O&&O.addEventListener("click",()=>{me()});const B=document.createElement("button");B.textContent="üì• Exportar JSON";B.className="btn";B.style.marginBottom="15px";h&&(h.parentNode.insertBefore(B,h),B.addEventListener("click",()=>{he()}));h&&h.addEventListener("click",async e=>{if(e.target.classList.contains("edit")){const t=e.target.dataset.id;pe(t)}if(e.target.classList.contains("delete")){const t=e.target.dataset.id;ye(t,e.target)}});P&&P.addEventListener("click",Ee);U&&U.addEventListener("click",M);L&&L.addEventListener("click",e=>{e.target===L&&M()});x&&x.addEventListener("submit",async e=>{e.preventDefault();const o=x.querySelector(".submit")?.dataset.editId,a=Be.value.trim(),r=be.value.trim(),s=l.value.trim();o?await ge(o,a,r,s):await ve(a,r,s)});
